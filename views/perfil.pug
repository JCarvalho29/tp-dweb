extends layout

block content
	#inicioPagina

		.w3-container(id="id" name=perfil.fotoPerfil.idAtual style="height: 100%;")
			.w3-card-4(style="width:100%")
				header.w3-container.w3-round-large(style='background-color: rgb(59,100,170); color: white;')
					h3 Perfil de 
						=perfil.nome
				.w3-card-4(style="width: 25%; float: left")
					img(style="max-width: 90%; margin-top: 5%; margin-left: 5%;" src="http://localhost:3000/api/files/foto?userId=" + perfil._id + "&fotoId=" + perfil.fotoPerfil.idAtual)
					input.w3-container.w3-round-large(id='fotosPerfil' value='Ver Fotos Perfil' style='background-color: rgb(59,100,170); color: white;max-width: 70%; margin-left:15%; margin-top:2%')
					h3(style="margin-top: 5%; margin-left: 10%;")= perfil.nome
					p(style="margin-top: -5%;margin-left: 15%;") Username: 
						=perfil.username
					h3(style="margin-top: 5%; margin-left: 10%;") Publicações Feitas: 
						=perfil.npubs
				
				.w3container(style="width:75%; float:right;")
					br
					.w3-card-4(style="position:absolute; width:65%;")
						header.w3-container.w3-round-large(style="background-color: rgb(59,100,170); color: white;")
							h3 Publicações
						each p in perfil.pubs
							publicacao.w3-container(id=p._id)
								.w3-card-4
									header.w3-container.w3-round-large(style='background-color: rgb(59,100,170); color: white;')
										div(style="flex: 50%;padding: 4px;float: left")
											img(style="max-width: 100px; max-height: 100px;margin-right: 20px;vertical-align: up;" src="http://localhost:3000/api/files/foto?userId=" + p.utilizador._id + "&fotoId=" + p.utilizador.fotoPerfil.idAtual)
										h2=p.utilizador.nome
									.w3-container
										if p.tituloPub
											h2=p.tituloPub
										h4="Publicado em " + p.data
										if p.local
											h4="Local: " + p.local
										h5="Público: " + p.publico
										each e in p.elems
											h4="TIPO: "+ e.tipo
											if e.tipo == "lista"
												h2= e.lista.titulo
												ul.w3-ul.w3-hoverable
												each item in e.lista.itens
													li=item
											if e.tipo == "ficheiros"
												p= e.ficheiros.titulo
												ul
													each item in e.ficheiros.ficheiros
														li
															if (item.isImage == true)
																a(href='/api/files?username=' + p.utilizador.username + '&idPub=' + p._id + '&idFich=' + item._id + '&data=' + p.data)
																	img(style="max-width: 160px; max-height: 160px;" src='/api/files?username=' + p.utilizador.username + '&idPub=' + p._id + '&idFich=' + item._id + '&data=' + p.data)
															else
																a(href='/api/files?username=' + p.utilizador.username + '&idPub=' + p._id + '&idFich=' + item._id + '&data=' + p.data)= item.nome
											if e.tipo =="narracao"
												h2 Narração!
												if e.narracao.titulo
													p(style="text-align: center;")= e.narracao.titulo
												cite= e.narracao.texto
												if e.narracao.autor
													p="Autor: " +  e.narracao.autor
											if e.tipo =="opiniao"
												h2 Opinião!
												p= e.opiniao.opiniao
											if e.tipo =="evento"
												h2 Evento!
												h2=e.evento.titulo
												h3=e.evento.data
												h3="Tipo de evento: " + e.evento.atividade
												if e.evento.duracao
													h3="Duração: " + e.evento.duracao
												if e.evento.descricao
													h4 Descrição
													p=e.evento.descricao
												br
										input.pubLike.w3-btn.w3-small.w3-round-xxlarge(type='button' id=p._id+"_Gosto" value='Gosto (' + p.gostos.length + ')' name=p.gostos.length style='background-color: rgb(59,100,170); color: white; margin-left:10px; margin-top:15px;')
										br
										br
										.w3-card-4(style='margin-top:5px;')
											header.w3-container.w3-round-large(style='background-color: rgb(59,100,170); color: white;')
												h6
													b Comentários
											.w3-container
												form.w3-container.w3-bottombar.w3-border-grey(id=p._id+"novoComent" style='margin-bottom:15px;')
													table(style='width:100%; margin-top:15px; margin-bottom:15px;')
														tr
															td(style='width:85%')
																input#comentario.w3-input.w3-border.w3-light-grey.w3-round-xxlarge(type='text' placeholder='Escreve um comentário' style='margin-left:20px;' required)
															td
																input.w3-btn.w3-round-large(type='submit' value='Publicar' style='background-color: rgb(59,100,170); color: white; margin-left:40px;')
												comentarios
													if p.comentarios.length
														each c in p.comentarios
															.w3-container.w3-border.w3-round-xxlarge.w3-light-grey(style='margin-top:10px;')
																.w3-container(style='margin-bottom:10px; word-wrap: break-word')    
																	p
																		b(style='color: rgb(59,100,170);')= c.utilizador.nome
																		| &nbsp;&nbsp;&nbsp; #{c.texto}
																	input.commentLike.w3-btn.w3-small.w3-round-xxlarge(type='button' id=c._id value='Gosto (' + c.gostos.length + ')' name=c.gostos.length style='background-color: rgb(59,100,170); color: white; margin-left:5px;')
													else 
														.w3-container(id=p._id+"NoComments" style='margin-top:20px;')
															b(style='color:dark-grey;') Não existem comentários para mostrar. Seja o primeiro a comentar esta publicação!
												br
										br
										br

			

	br
	br
	a(href="/pubs") Voltar ao Feed
	br
	br
	div(style="bottom: 0px; float: bottom")
		footer.w3-container.w3-round-large(style="background-color: rgb(59,100,170); color: white;text-align: center;position: absolute; bottom: 0px")
			address Powered by Desenvolvimento de Aplicações Web
	
	script(src="/javascripts/perfil.js")
	script(src="/javascripts/axios.min.js")